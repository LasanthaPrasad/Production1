{% extends "base.html" %}
{% block content %}
<h1>Create Solar Plant</h1>
<form method="POST">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.name.label }}
        {{ form.name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.latitude.label }}
        {{ form.latitude(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.longitude.label }}
        {{ form.longitude(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.grid_substation.label }}
        {{ form.grid_substation(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.feeder.label }}
        {{ form.feeder(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.forecast_location.label }}
        {{ form.forecast_location(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.installed_capacity.label }}
        {{ form.installed_capacity(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.panel_capacity.label }}
        {{ form.panel_capacity(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.inverter_capacity.label }}
        {{ form.inverter_capacity(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.plant_angle.label }}
        {{ form.plant_angle(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.company.label }}
        {{ form.company(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.api_status.label }}
        {{ form.api_status(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.plant_efficiency.label }}
        {{ form.plant_efficiency(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.coefficient_factor.label }}
        {{ form.coefficient_factor(class="form-control") }}
    </div>
    {{ form.submit(class="btn btn-primary") }}
</form>
{% endblock %}

{% block scripts %}
<script>
    // Add JavaScript to dynamically populate feeders based on selected substation
    document.getElementById('grid_substation').addEventListener('change', function() {
        var substationId = this.value;
        var feederSelect = document.getElementById('feeder');
        // Clear current options
        feederSelect.innerHTML = '';
        // Fetch feeders for selected substation
        fetch('/get_feeders/' + substationId)
            .then(response => response.json())
            .then(data => {
                data.forEach(feeder => {
                    var option = document.createElement('option');
                    option.value = feeder.id;
                    option.textContent = feeder.name;
                    feederSelect.appendChild(option);
                });
            });
    });
</script>
{% endblock %}