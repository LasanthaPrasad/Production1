{% extends "base.html" %}
{% block content %}
<h1>Create Solar Plant</h1>
<form method="POST">
    {{ form.hidden_tag() }}
    <div class="form-group">
        {{ form.name.label }}
        {{ form.name(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.latitude.label }}
        {{ form.latitude(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.longitude.label }}
        {{ form.longitude(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.grid_substation.label }}
        {{ form.grid_substation(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.feeder.label }}
        {{ form.feeder(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.forecast_location.label }}
        {{ form.forecast_location(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.installed_capacity.label }}
        {{ form.installed_capacity(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.panel_capacity.label }}
        {{ form.panel_capacity(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.inverter_capacity.label }}
        {{ form.inverter_capacity(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.plant_angle.label }}
        {{ form.plant_angle(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.company.label }}
        {{ form.company(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.api_status.label }}
        {{ form.api_status(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.plant_efficiency.label }}
        {{ form.plant_efficiency(class="form-control") }}
    </div>
    <div class="form-group">
        {{ form.coefficient_factor.label }}
        {{ form.coefficient_factor(class="form-control") }}
    </div>
    {{ form.submit(class="btn btn-primary") }}
</form>
{% endblock %}






{% block scripts %}
<script>
        console.log('Script loaded');

    document.addEventListener('DOMContentLoaded', function() {

        print('DOM content loaded');

        var gridSubstationSelect = document.getElementById('grid_substation');
        var feederSelect = document.getElementById('feeder');

        function updateFeeders() {
            var substationId = gridSubstationSelect.value;
            console.log('Selected substation ID:', substationId);
            feederSelect.innerHTML = '<option value="">Loading...</option>';
            
            fetch('/get_feeders/' + substationId)
                .then(response => {
                    print('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Received feeder data:', data);
                    feederSelect.innerHTML = '<option value="">Select a Feeder</option>';
                    if (data.length === 0) {
                        console.log('No feeders found for this substation');
                    }
                    data.forEach(feeder => {
                        console.log('Adding feeder:', feeder);
                        var option = document.createElement('option');
                        option.value = feeder.id;
                        option.textContent = feeder.name;
                        feederSelect.appendChild(option);
                    });
                    console.log('Final feeder select HTML:', feederSelect.innerHTML);
                })

                .catch(error => {
                    console.error('Error:', error);
                    feederSelect.innerHTML = '<option value="">Error loading feeders</option>';
                });
        }

        gridSubstationSelect.addEventListener('change', updateFeeders);

        // Initial load of feeders if a substation is already selected
        if (gridSubstationSelect.value) {
            console.log('Grid substation changed:', event.target.value);
            updateFeeders();
        }
    });
</script>
{% endblock %}
