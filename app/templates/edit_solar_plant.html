{% extends "base.html" %}

{% block content %}
<h1>{% if plant %}Edit{% else %}Create{% endif %} Solar Plant</h1>
<form method="POST">
    <div class="form-group">
        <label for="name">Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{ plant.name if plant else '' }}" required>
    </div>
    <div class="form-group">
        <label for="latitude">Latitude</label>
        <input type="number" step="any" class="form-control" id="latitude" name="latitude" value="{{ plant.latitude if plant else '' }}" required>
    </div>
    <div class="form-group">
        <label for="longitude">Longitude</label>
        <input type="number" step="any" class="form-control" id="longitude" name="longitude" value="{{ plant.longitude if plant else '' }}" required>
    </div>
    <div class="form-group">
        <label for="grid_substation">Grid Substation</label>
        <select class="form-control" id="grid_substation" name="grid_substation" required>
            <option value="">Select a Grid Substation</option>
            {% for substation in substations %}
            <option value="{{ substation.id }}" {% if plant and plant.grid_substation == substation.id %}selected{% endif %}>
                {{ substation.name }}
            </option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label for="feeder">Feeder</label>
        <select class="form-control" id="feeder" name="feeder" required>
            <option value="">Select a Feeder</option>
            {% if plant %}
                {% for feeder in feeders %}
                <option value="{{ feeder.id }}" {% if plant.feeder == feeder.id %}selected{% endif %}>
                    {{ feeder.name }}
                </option>
                {% endfor %}
            {% endif %}
        </select>
    </div>
    <!-- Add other fields here -->
    <button type="submit" class="btn btn-primary">{% if plant %}Update{% else %}Create{% endif %}</button>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('grid_substation').addEventListener('change', function() {
    const substationId = this.value;
    const feederSelect = document.getElementById('feeder');
    
    // Clear current options
    feederSelect.innerHTML = '<option value="">Select a Feeder</option>';
    
    if (substationId) {
        // Fetch feeders for the selected substation
        fetch(`/get_feeders/${substationId}`)
            .then(response => response.json())
            .then(feeders => {
                feeders.forEach(feeder => {
                    const option = document.createElement('option');
                    option.value = feeder.id;
                    option.textContent = feeder.name;
                    feederSelect.appendChild(option);
                });
            });
    }
});
</script>
{% endblock %}